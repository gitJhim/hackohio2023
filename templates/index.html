<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>

<body>
    <div class="min-h-screen bg-gradient-to-r from-purple-300 via-pink-200 to-red-200 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700 flex items-center justify-center">
        <div class="w-full h-full max-w-md mx-auto bg-white shadow-md rounded-lg overflow-hidden dark:bg-zinc-900">
          <div class="flex justify-between items-center px-6 py-4">
            <div class="flex items-center mx-auto my-auto">
                <svg height="36px" width="36px" viewbox="0 0 100 100">
                    <path>
                      <animate 
                         attributeName="d" 
                         dur="3000ms" 
                         repeatCount="indefinite"
                         keyTimes="0;
                                   .0625;
                                   .3125;
                                   .395833333;
                                   .645833333;
                                   .833333333;
                                   1"
                         calcMode="spline" 
                         keySplines="0,0,1,1;
                                     .42,0,1,1;
                                     0,0,.58,1;
                                     .42,0,.58,1;
                                     .42,0,.58,1;
                                     .42,0,.58,1"
                             
                         values="M 0,0 C 50,0 50,0 100,0 100,50 100,50 100,100
                                 50,100 50,100 0,100 0,50 0,50 0,0 Z;
                                       
                                 M 0,0 C 50,0 50,0 100,0 100,50 100,50 100,100
                                 50,100 50,100 0,100 0,50 0,50 0,0 Z; 
                  
                                 M 50,0 C 75,50 75,50 100,100 50,100 50,100 0,100
                                 12.5,75 12.5,75 25,50 37.5,25 37.5,25 50,0 Z;
                  
                                 M 50,0 C 75,50 75,50 100,100 50,100 50,100 0,100
                                 12.5,75 12.5,75 25,50 37.5,25 37.5,25 50,0 Z;
                  
                                 M 100,50 C 100,77.6 77.6,100 50,100 22.4,100 0,77.6
                                 0,50 0,22.4 22.4,0 50,0 77.6,0 100,22.4 100,50 Z;
                                       
                                 M 100,50 C 100,77.6 77.6,100 50,100 22.4,100 0,77.6 
                                 0,50 0,22.4 22.4,0, 50,0 77.6,0 100,22.4 100,50 Z;
                                       
                                 M 100,100 C 50,100 50,100 0,100 0,50 0,50 0,0
                                 50,0 50,0 100,0 100,50 100,50 100,100 Z;"/>
                      <animate 
                         attributeName="fill"
                         dur="3000ms" 
                         repeatCount="indefinite"
                         keyTimes="0;
                                   .0625;
                                   .3125;
                                   .395833333;
                                   .645833333;
                                   .833333333;
                                   1"
                         calcMode="spline" 
                         keySplines="0,0,1,1;
                                     .42,0,1,1;
                                     0,0,.58,1;
                                     .42,0,.58,1;
                                     .42,0,.58,1;
                                     .42,0,.58,1"
                         values="#FFA400;
                                 #FFA400;
                                 #FF4E42;
                                 #FF4E42;
                                 #0CCE6B;
                                 #0CCE6B;
                                 #FFA400;"/>
                    </path>
                  </svg>
                  
                <div class="mx-3">
                <h3 class="text-lg font-medium text-gray-700 dark:text-gray-200">Scanning...</h3>
                <p class="text-gray-500 dark:text-gray-400">Looking for identifiers...</p>
              </div>
            </div>
            <div class="flex">
            
                      <!-- Dropdown Container -->
          <div class="relative inline-block text-left">
            <!-- Trigger Button -->
            <button type="button" class="inline-flex justify-center w-64 rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500" id="dropdown-button">
              Choose destination...
              <!-- Icon -->
              <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M5.293 9.293a1 1 0 011.414 0L10 12.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Dropdown Menu -->
            <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10" id="dropdown-menu" hidden>
              <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="dropdown-button">
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Performance Hall</a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Sloopy's Diner</a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">U.S Bank</a>
              </div>
            </div>
          </div>
            </div>
          </div>
          <div class="relative">
            <img src="/video_feed" class="object-cover rounded-lg" alt="Live Video Stream">
          </div>
          <div class="px-6 py-4 text-zinc-300">
            <div class="p-4 bg-dark shadow-lg rounded-lg">
              <div class="flex flex-col">
                <div class="flex">
                  <h2 class="text-2xl font-bold mb-4 mr-4">Zone Info</h2>
                  <svg id="svg" height="36" width="36">
                </svg>
                <h2 class="text-2xl font-bold ml-auto text-zinc-600" id="floor"></h2>
                </div>
                  <div class="w-full flex">
                  </div>
                  <div id="match" class="mb-2">
                  </div>
                  <div id="lists" class="mb-2">
                    <div class="flex justify-evenly mb-4">
                      <div class="mx-2">
                        <h4>Locations: </h4>
                        <ul id="locations-list"></ul>
                      </div>
                      <div class="mx-2">
                        <h4>Ammenities: </h4>
                        <ul id="ammenities-list"></ul>
                      </div>
                    </div>
                </div>
                  <img id="floor-image" src="" alt="" class="w-full h-full object-cover rounded-md mb-4" />
                  <p class="text-zinc-400 text-center" id="description"></p>
              </div>
          </div>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        const socket = io.connect('http://localhost:5000');
        const svg = document.getElementById('svg');
        const matchText = document.getElementById('match');
        const lists = document.getElementById("lists")

        const dropdownButton = document.getElementById('dropdown-button');
         const dropdownMenu = document.getElementById('dropdown-menu');

        dropdownButton.addEventListener('click', () => {
          const isHidden = dropdownMenu.getAttribute('hidden') !== null;
          if (isHidden) {
            dropdownMenu.removeAttribute('hidden');
          } else {
            dropdownMenu.setAttribute('hidden', '');
          }
        });

        dropdownMenu.addEventListener('click' , () => {
          console.log(event.target.innerText)
          dropdownButton.innerHTML = event.target.innerText
          dropdownMenu.hidden = true
        })

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('update', (data) => {
            console.log('Update received:', data);
            svg.innerHTML = ""
            matchText.textContent = "No Match"
            lists.hidden = true
            
            switch(data.data) {
                case "Blue Rectangle":
                    var shape = document.createElementNS('http://www.w3.org/2000/svg', 'rect');

                    shape.setAttribute('width', '36');
                    shape.setAttribute('height', '36');
                    shape.setAttribute('style', 'fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)');
                    
                    svg.appendChild(shape); 
                    matchText.textContent = ""
                    break;
                case "Blue Triangle":
                var shape = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    shape.setAttribute('points', '18,1 36,36 1,36');
                    shape.setAttribute('style', 'fill:blue;');
                    
                    svg.appendChild(shape);
                    matchText.textContent = ""

                    document.getElementById("floor").textContent = "FLOOR 1";

                    if(dropdownButton.innerHTML == "Sloopy's Diner") {
                      document.getElementById("floor-image").setAttribute("src", "../static/floor-one-sloopy.png" );
                      document.getElementById("description").innerText = "Please follow the directions above to get to Sloopy's Diner."
                    } else {
                      document.getElementById("floor-image").setAttribute("src", "../static/floor-one.png" );
                    }
                    const locationArray = ['Express-OH', 'Union Market', "Woody's Tavern", "Sloopy's Diner"]; 
                
                    const locationUL = document.getElementById('locations-list');
                    locationUL.innerHTML = ""
                
                    locationArray.forEach(item => {
                        const liElement = document.createElement('li');
                        liElement.textContent = item;
                        locationUL.appendChild(liElement);
                    });

                    const ammenitiesArray =  ["Stairs", 'Elevator', 'Restroom', '...']; 
                
                    const ammenitiesUL = document.getElementById('ammenities-list');

                    ammenitiesUL.innerHTML = ""
                
                    ammenitiesArray.forEach(item => {
                        const liElement = document.createElement('li');
                        liElement.textContent = item;
                        ammenitiesUL.appendChild(liElement);
                    });

                    lists.hidden = false;

                    break;
                case "Blue Circle":
                var shape = document.createElementNS('http://www.w3.org/2000/svg', 'circle');

                    shape.setAttribute('cx', '18');
                    shape.setAttribute('cy', '18');
                    shape.setAttribute('r', '18');
                    shape.setAttribute('stroke', 'none');
                    shape.setAttribute('stroke-width', '3');
                    shape.setAttribute('fill', 'blue');

                    svg.appendChild(shape);
                    matchText.textContent = ""

                    break;
                case "Green Rectangle":
                var shape = document.createElementNS('http://www.w3.org/2000/svg', 'rect');

                    shape.setAttribute('width', '36');
                    shape.setAttribute('height', '36');
                    shape.setAttribute('style', 'fill:rgb(0,255,0);stroke-width:3;stroke:rgb(0,0,0)');
                    
                    svg.appendChild(shape); 
                    matchText.textContent = ""

                    break;
                case "Red Triangle":
                var shape = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');

                    shape.setAttribute('points', '18,1 36,36 1,36');
                    shape.setAttribute('style', 'fill:red;');
                    
                    svg.appendChild(shape);
                    matchText.textContent = ""

                    document.getElementById("floor").textContent = "FLOOR 1";

                    document.getElementById("floor-image").setAttribute("src", "../static/floor-one.png" );
                    const locArray = ['Great Hall Meeting Room', 'Performance Hall', "US Bank", "..."]; 
                
                    const locUL = document.getElementById('locations-list');
                    locUL.innerHTML = ""
                
                    locArray.forEach(item => {
                        const liElement = document.createElement('li');
                        liElement.textContent = item;
                        locUL.appendChild(liElement);
                    });

                    const ammenArray =  ["Stairs", 'Elevator', 'Restroom', '...']; 
                
                    const ammenUL = document.getElementById('ammenities-list');

                    ammenUL.innerHTML = ""
                
                    ammenArray.forEach(item => {
                        const liElement = document.createElement('li');
                        liElement.textContent = item;
                        ammenUL.appendChild(liElement);
                    });

                    lists.hidden = false;

                    break;
                case "Green Circle":
                var shape = document.createElementNS('http://www.w3.org/2000/svg', 'circle');

                    shape.setAttribute('cx', '18');
                    shape.setAttribute('cy', '18');
                    shape.setAttribute('r', '18');
                    shape.setAttribute('stroke', 'none');
                    shape.setAttribute('stroke-width', '3');
                    shape.setAttribute('fill', 'green');

                    svg.appendChild(shape);
                    matchText.textContent = ""

                    document.getElementById("floor").textContent = "FLOOR 3";

                    document.getElementById("floor-image").setAttribute("src", "../static/floor-three.png" );
                    const locc= ['Undergraduate Admissions', 'Office of SVP Student Life', "Keith B. Key", "..."]; 
                
                    const loccUL = document.getElementById('locations-list');
                    loccUL.innerHTML = ""
                    
                    locc.forEach(item => {
                        const liElement = document.createElement('li');
                        liElement.textContent = item;
                        loccUL.appendChild(liElement);
                    });

                    const ammenn =  ["Stairs", 'Elevator', 'Restroom', '...']; 
                
                    const ammennUL = document.getElementById('ammenities-list');

                    ammennUL.innerHTML = ""
                
                    ammenn.forEach(item => {
                        const liElement = document.createElement('li');
                        liElement.textContent = item;
                        ammennUL.appendChild(liElement);
                    });

                    lists.hidden = false;

                    break;
                case "None":
                    svg.innerHTML = ""
                    matchText.textContent = "No Match."
                    break;
            }
        });
    </script>
</body>